/*!
 * micro-bridge v1.1.0
 * (c) 2020-2021 fz6m
 * Released under the MIT License.
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("lodash/get"),e=require("lodash/set"),n=require("lodash/isEqual");function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=r(t),u=r(e),i=r(n),a=["__subscribe__","__value_subscribe__"];o.default(window,"_$store")||u.default(window,"_$store",{});var f=function(t){return"function"==typeof t},c=function(t){return~a.indexOf(t)},l=function(t){return(c(t)?"__$$":"_$")+t},d=function(t,e){return(c(t)?"__$$":"_$")+t+"."+e},s=function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function v(t,e){for(var n=0,r=e.length,o=t.length;n<r;n++,o++)t[o]=e[n];return t}var p=function(t,e){return q(t,e)||[]},_=function(t,e,n){var r=p(t,n);if(!~r.indexOf(e)){var o=v(v([],r),[e]);j(t,o,n)}},h=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=p(t,e);o.forEach((function(t){try{t.apply(void 0,n)}catch(t){}}))},y=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=p("_$all",t);r.forEach((function(t){try{t.apply(void 0,e)}catch(t){}}))},$=function(t){return{get:function(e){return p(e,t)},add:function(e,n){return _(e,n,t)},addToAll:function(e){return function(t,e){_("_$all",t,e)}(e,t)},destory:function(e){return function(t,e){j(t,[],e)}(e,t)},delete:function(e,n){return function(t,e,n){var r=p(t,n),o=r.indexOf(e);return!!~o&&(r.splice(o,1),j(t,r,n),!0)}(e,n,t)},dispacth:function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return h.apply(void 0,v([e,t],n))},dispatchAll:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return y.apply(void 0,v([t],e))}}},g=$("__value_subscribe__"),b=function(t){var e=t.key,n=t.newValue,r=t.oldValue,o=t.newStoreValue;(function(t){return a.some((function(e){return t.startsWith(l(e))}))})(e)||i.default(r,n)||(g.dispatchAll(o),g.dispacth(e,n,r))};var w={$on:function(t,e){!f(t)||e?"string"==typeof t&&f(e)&&g.add(t,e):g.addToAll(t)},$destory:g.destory,$delete:g.delete},S=function(){return o.default(window,"_$store")||{}},x=function(){return function(t){var e=s({},t);return a.forEach((function(t){delete e[l(t)]})),e}(S())},O=function(t){var e=S();return o.default(e,t)},V=function(t,e){var n=O(t),r=S();u.default(r,t,e),b({key:t,newValue:e,oldValue:n,newStoreValue:x()})},j=function(t,e,n){var r=d(n,t);V(r,e)},q=function(t,e){var n=d(e,t);return O(n)},A={getStore:x,get:O,set:V,getWithScope:q,setWithScope:j,getScope:function(t){var e=l(t);return O(e)||{}},setScope:function(t,e){var n=l(e);V(n,t)}},E=$("__subscribe__"),W={$on:E.add,$off:E.destory,$emit:function(t,e){E.dispacth(t,e)},$delete:E.delete};exports.Store=A,exports.StoreBus=W,exports.StoreChange=w;
