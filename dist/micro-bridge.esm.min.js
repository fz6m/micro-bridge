/*!
 * micro-bridge v1.1.0
 * (c) 2020-2021 fz6m
 * Released under the MIT License.
 */
import n from"lodash/get";import t from"lodash/set";import r from"lodash/isEqual";var e=["__subscribe__","__value_subscribe__"];n(window,"_$store")||t(window,"_$store",{});var o=function(n){return"function"==typeof n},u=function(n){return~e.indexOf(n)},i=function(n){return(u(n)?"__$$":"_$")+n},c=function(n,t){return(u(n)?"__$$":"_$")+n+"."+t},a=function(){return(a=Object.assign||function(n){for(var t,r=1,e=arguments.length;r<e;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)};function f(n,t){for(var r=0,e=t.length,o=n.length;r<e;r++,o++)n[o]=t[r];return n}var l=function(n,t){return S(n,t)||[]},d=function(n,t,r){var e=l(n,r);if(!~e.indexOf(t)){var o=f(f([],e),[t]);m(n,o,r)}},s=function(n,t){for(var r=[],e=2;e<arguments.length;e++)r[e-2]=arguments[e];var o=l(n,t);o.forEach((function(n){try{n.apply(void 0,r)}catch(n){}}))},v=function(n){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var e=l("_$all",n);e.forEach((function(n){try{n.apply(void 0,t)}catch(n){}}))},p=function(n){return{get:function(t){return l(t,n)},add:function(t,r){return d(t,r,n)},addToAll:function(t){return function(n,t){d("_$all",n,t)}(t,n)},destory:function(t){return function(n,t){m(n,[],t)}(t,n)},delete:function(t,r){return function(n,t,r){var e=l(n,r),o=e.indexOf(t);return!!~o&&(e.splice(o,1),m(n,e,r),!0)}(t,r,n)},dispacth:function(t){for(var r=[],e=1;e<arguments.length;e++)r[e-1]=arguments[e];return s.apply(void 0,f([t,n],r))},dispatchAll:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return v.apply(void 0,f([n],t))}}},_=p("__value_subscribe__"),h=function(n){var t=n.key,o=n.newValue,u=n.oldValue,c=n.newStoreValue;(function(n){return e.some((function(t){return n.startsWith(i(t))}))})(t)||r(u,o)||(_.dispatchAll(c),_.dispacth(t,o,u))};var $={$on:function(n,t){!o(n)||t?"string"==typeof n&&o(t)&&_.add(n,t):_.addToAll(n)},$destory:_.destory,$delete:_.delete},y=function(){return n(window,"_$store")||{}},g=function(){return function(n){var t=a({},n);return e.forEach((function(n){delete t[i(n)]})),t}(y())},w=function(t){var r=y();return n(r,t)},b=function(n,r){var e=w(n),o=y();t(o,n,r),h({key:n,newValue:r,oldValue:e,newStoreValue:g()})},m=function(n,t,r){var e=c(r,n);b(e,t)},S=function(n,t){var r=c(t,n);return w(r)},O={getStore:g,get:w,set:b,getWithScope:S,setWithScope:m,getScope:function(n){var t=i(n);return w(t)||{}},setScope:function(n,t){var r=i(t);b(r,n)}},V=p("__subscribe__"),x={$on:V.add,$off:V.destory,$emit:function(n,t){V.dispacth(n,t)},$delete:V.delete};export{O as Store,x as StoreBus,$ as StoreChange};
